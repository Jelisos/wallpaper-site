## JavaScript文件功能概述

### 核心功能文件

1. **main.js**
   - 网站通用功能入口文件
   - 包含通用工具函数如`escapeHTML`
   - 初始化模态框管理器、图片加载器
   - 处理返回顶部按钮、页头滚动效果、移动菜单
   - **专注分类管理功能**：分类管理模态框、添加/删除分类、保存分类
   - 处理登录/注册模态框的基础事件监听

2. **wallpaper.js**
   - **已废弃文件**，功能已完全迁移至image-loader.js
   - 保留空的WallpaperManager对象以维持向后兼容性
   - 建议在后续版本中删除此文件

3. **image-loader.js**
   - **首页图片加载核心模块**
   - 全面接管首页壁纸加载、分类管理、搜索功能
   - 集成网格/列表视图切换、加载更多、流放/召回功能
   - 处理壁纸数据的加载和视图更新
   - 管理分页状态和用户交互事件
   - 整合了原main.js和wallpaper.js中的首页图片相关功能

4. **wallpaper-detail.js**
   - **壁纸详情模态框专用模块**
   - 全面管理壁纸详情模态框的显示和交互
   - 整合了modals.js中的壁纸详情模态框功能
   - 实现壁纸详情的获取和展示
   - 处理预览、下载、点赞、收藏功能
   - 管理按钮状态和用户交互
   - 提供全局接口供其他模块调用

### 用户交互与界面

5. **modals.js**
   - 通用模态框管理器，统一管理登录、注册、上传、分类管理等模态框
   - 提供统一的模态框动画效果和事件处理
   - **注意**：壁纸详情模态框功能已迁移至wallpaper-detail.js

6. **auth.js**
   - 用户认证功能
   - 处理登录、注册模态框
   - 实现表单验证和用户数据管理
   - 与后端API交互进行用户认证

7. **user-menu.js**
   - 用户菜单功能
   - 切换和关闭用户下拉菜单
   - 检查用户登录状态
   - 动态更新用户菜单UI
   - 处理用户登出功能

8. **upload.js**
   - 壁纸上传功能
   - 处理文件选择（点击、拖放）
   - 实现文件验证和预览
   - 管理表单提交和上传进度

### 工具与配置

9. **utils.js**
   - 通用工具函数集合
   - 提供防抖、数组随机化功能
   - 实现壁纸文件名解析
   - 客户端图片压缩功能
   - 临时消息提示功能

10. **config.js**
    - 全局配置设置
    - 分页配置（每页项目数）
    - 图像处理参数（最大尺寸、质量、类型）
    - 动画持续时间
    - 搜索防抖延迟

11. **svg-icons.js**
    - SVG图标处理模块
    - 替换Font Awesome图标为SVG
    - 观察DOM变化更新图标
    - 处理模态框内图标更新

12. **qrious.min.js**
    - 第三方二维码生成库
    - 提供QR码创建和渲染功能

## 项目索引更新建议

建议在项目索引的「技术栈」和「功能模块」部分添加以下内容：

### 技术栈 - 前端

- **JavaScript模块化**：采用模块化设计，各功能模块职责明确
- **本地存储**：使用localStorage存储用户偏好和状态
- **响应式设计**：支持网格/列表视图切换，适配不同设备
- **客户端图片处理**：实现客户端图片压缩和预览
- **SVG图标系统**：动态替换Font Awesome图标为SVG

### 功能模块 - 前端交互

- **壁纸浏览**：支持网格/列表视图切换，实现无限滚动加载
- **壁纸详情**：模态框展示壁纸详细信息，支持预览和下载
- **用户交互**：点赞、收藏、评论等社交功能
- **搜索过滤**：按类别、标签搜索壁纸
- **上传功能**：支持拖放上传，文件预览和压缩
- **用户认证**：登录/注册模态框，表单验证
- **个人中心**：用户菜单，个人设置管理

这些信息可以帮助开发者更好地理解项目的JavaScript架构和功能实现。





# 壁纸自由项目索引
全局特别提示：打开trae之前，我已经启动XAMPP的Apache和MySQL（请勿重复启动本地服务） 
通过localhost访问项目根目录即可

## 1. 项目概述

**项目名称**：壁纸自由
**项目目录**：F:\XAMPP\htdocs
**项目类型**：Web应用
**技术栈**：HTML5、CSS3、JavaScript、PHP、MySQL、Tailwind CSS

**项目简介**：
壁纸自由是一个基于Web的壁纸展示和管理系统，支持壁纸浏览、上传、下载、点赞、收藏等功能，兼容PC和移动端。系统采用前后端分离架构，前端使用HTML、CSS和JavaScript实现用户界面，后端使用PHP和MySQL提供数据服务。

## 2. 目录结构

```
F:\XAMPP\htdocs\
├── api\                   # 后端API接口
│   ├── auth.php           # 用户认证相关接口
│   ├── favorite_wallpaper.php  # 收藏壁纸接口
│   ├── like_wallpaper.php # 点赞壁纸接口
│   ├── login.php          # 登录接口
│   ├── logout.php         # 退出登录接口
│   ├── register.php       # 注册接口
│   ├── utils.php          # 工具函数
│   └── write_log.php      # 日志记录接口
├── config\                # 配置文件
│   ├── database.php       # 数据库配置
│   └── init.sql           # 数据库初始化SQL
├── logs\                  # 日志文件
│   └── wallpaper_debug_log.txt  # 调试日志
├── static\                # 静态资源
│   ├── css\               # 样式文件
│   ├── js\                # JavaScript文件
│   │   ├── main.js        # 主要JavaScript逻辑
│   │   └── wallpaper.js   # 壁纸相关功能
│   ├── icons\             # 图标资源
│   └── wallpapers\        # 壁纸图片
├── index.html            # 网站首页
├── dashboard.html        # 用户仪表盘
├── yulan.html            # 壁纸预览页面
├── detail-mobile.html    # 移动端详情页面
├── update-list.html      # 更新列表页面
├── admin.html            # 管理员页面
├── 开发进度.txt           # 开发进度记录
└── 项目分析.md            # 项目分析文档
```

## 3. 功能模块

### 3.1 用户系统

- **注册/登录**：支持用户注册和登录，使用session管理用户状态
- **个人中心**：用户可以查看和管理个人信息、上传的壁纸、收藏的壁纸等
- **权限控制**：区分普通用户和管理员权限

### 3.2 壁纸管理

- **壁纸浏览**：支持瀑布流和列表两种视图模式，分页加载
- **壁纸搜索**：支持按关键词搜索壁纸
- **壁纸上传**：用户可以上传自己的壁纸
- **壁纸预览**：支持多设备预览壁纸效果
- **壁纸下载**：用户可以下载壁纸

### 3.3 互动功能

- **点赞功能**：用户可以对壁纸点赞/取消点赞
- **收藏功能**：登录用户可以收藏/取消收藏壁纸
- **分享功能**：支持生成二维码分享壁纸

### 3.4 后台管理

- **壁纸管理**：管理员可以管理所有壁纸
- **用户管理**：管理员可以管理用户账号
- **系统设置**：管理员可以配置系统参数

## 4. 数据库设计

### 4.1 主要数据表

- **users**：用户表，存储用户信息
- **sessions**：会话表，存储用户会话信息
- **wallpaper_likes**：壁纸点赞表，记录用户点赞信息
- **wallpaper_favorites**：壁纸收藏表，记录用户收藏信息

## 5. API接口

### 5.1 用户相关接口

- **注册**：/api/register.php
- **登录**：/api/login.php
- **退出登录**：/api/logout.php
- **获取用户信息**：/api/userinfo.php
- **修改密码**：/api/change_password.php
- **更新个人资料**：/api/update_profile.php

### 5.2 壁纸相关接口

- **点赞壁纸**：/api/like_wallpaper.php
- **取消点赞**：/api/unlike_wallpaper.php
- **收藏壁纸**：/api/favorite_wallpaper.php
- **取消收藏**：/api/unfavorite_wallpaper.php
- **检查点赞状态**：/api/check_like.php
- **检查收藏状态**：/api/check_favorite.php
- **获取点赞数**：/api/get_like_count.php

## 6. 开发进度

### 6.1 已完成功能

- 壁纸浏览与展示（瀑布流/列表视图）
- 壁纸详情弹窗
- 壁纸搜索
- 壁纸上传
- 点赞功能
- 收藏功能
- 用户登录/注册
- 日志记录系统

### 6.2 待完成功能

- 解决数据库连接问题
- 完善壁纸管理功能
- 完善用户个人中心
- 优化移动端体验

## 7. 开发规范

项目遵循以下开发规范：

- **代码风格**：使用JSDoc注释，关键逻辑添加中文注释
- **文件命名**：使用小写字母和下划线命名文件
- **API返回格式**：统一使用JSON格式，包含code、msg和data字段
- **错误处理**：统一的错误处理机制，友好的错误提示
- **日志记录**：使用write_log.php接口记录日志，格式为xxx_debug_log.txt

## 8. 部署环境

- **操作系统**：Windows 10 专业版
- **Web服务器**：XAMPP (Apache)
- **数据库**：MySQL
- **PHP版本**：7.4+
- **浏览器兼容**：Chrome、Firefox、Edge、Safari

## 9. 相关文档

- **项目分析.md**：详细的项目分析文档
- **项目规划.txt**：项目规划和功能完善计划
- **开发进度.txt**：开发进度记录
- **GIT操作指南.txt**：Git操作指南