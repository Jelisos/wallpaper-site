# 上传壁纸功能结构记录

## 前端文件结构

### 1. HTML结构 (index.html)
- **上传壁纸模态框** (第280-332行)
  - 模态框ID: `upload-modal`
  - 内容容器ID: `upload-modal-content`
  - 关闭按钮ID: `close-upload-modal`
  - 表单ID: `upload-form`
  - 文件输入框ID: `file-input`
  - 拖拽区域ID: `drop-area`
  - 预览容器ID: `preview-container`
  - 图片预览ID: `image-preview`
  - 浏览按钮ID: `browse-btn`
  - 标题输入框ID: `wallpaper-title`
  - 分类选择框ID: `wallpaper-category`
  - 标签输入框ID: `wallpaper-tags`
  - 取消按钮ID: `cancel-upload`
  - 提交按钮ID: `submit-upload`

- **添加分类模态框** (第334-352行)
  - 模态框ID: `add-category-modal`
  - 内容容器ID: `add-category-modal-content`
  - 关闭按钮ID: `close-add-category-modal`
  - 新分类输入框ID: `new-category`
  - 取消按钮ID: `cancel-add-category`
  - 提交按钮ID: `submit-add-category`

### 2. JavaScript文件

#### main.js (第93-638行相关代码)
- **DOM元素引用**:
  - uploadModal, uploadModalContent
  - fileInput, dropArea, previewContainer, imagePreview
  - wallpaperTitleInput, wallpaperCategorySelect, wallpaperTagsInput
  - submitUploadBtn, cancelUploadBtn, browseBtn

- **核心函数**:
  - `openUploadModal()` - 打开上传模态框
  - `closeUploadModal()` - 关闭上传模态框
  - `resetUploadModal()` - 重置模态框状态
  - `handleUploadSubmit(event)` - 处理上传提交

- **事件监听器**:
  - 上传按钮点击事件
  - 文件输入框变化事件
  - 表单提交事件
  - 拖拽上传事件

#### modals.js (第51, 414-433行)
- **ModalManager.initUploadModal()** - 初始化上传模态框
- 模态框打开/关闭效果处理
- 点击外部关闭功能

### 3. CSS样式
- **main.css** - 模态框样式定义
  - `.modal` 类 - 基础模态框样式
  - `.modal.show` 和 `.modal.hidden` 类 - 显示/隐藏状态
  - `#upload-modal`, `#add-category-modal` 等特定模态框样式

## 后端文件结构

### 1. API接口 (api/wallpaper.php)
- **handleUploadWallpaper()** 函数 (第74-148行)
  - 用户登录验证
  - 文件上传验证
  - 文件类型和大小检查
  - 图片信息获取
  - 文件保存到 `../static/wallpapers/` 目录
  - 数据库记录插入

### 2. 数据库表结构
- **wallpapers表** 字段:
  - user_id, title, description, file_path
  - file_size, width, height, category, tags
  - created_at

## 功能特性

### 1. 文件上传
- 支持格式: JPG, PNG, WebP
- 最大文件大小: 10MB
- 拖拽上传支持
- 图片预览功能

### 2. 表单字段
- 壁纸标题 (必填)
- 壁纸分类 (可选)
- 标签 (逗号分隔)
- 描述 (可选)

### 3. 验证机制
- 前端: 文件类型、标题必填验证
- 后端: 用户登录、文件格式、大小验证
- 数据库: 壁纸信息持久化存储

### 4. 用户体验
- 模态框交互
- 上传进度提示
- 成功/失败反馈
- 表单重置功能

## 相关文件列表

### 前端文件
- `index.html` - 主页面和模态框HTML
- `static/js/main.js` - 主要上传逻辑
- `static/js/modals.js` - 模态框管理
- `static/css/main.css` - 样式定义

### 后端文件
- `api/wallpaper.php` - 上传API接口
- `api/my_uploads.php` - 用户上传列表

### 存储目录
- `static/wallpapers/` - 壁纸文件存储目录

### 其他相关文件
- `dashboard.html` - 用户面板上传功能
- `admin.html` - 管理员面板
- `yulan.html` - 预览功能页面

---

**记录时间**: 2024年当前时间
**记录目的**: 为重写上传壁纸功能做准备