# XAMPP环境下的问题调试与解决规则

## 一、环境约束与前提

### 1.1 服务状态确认
- **Apache服务**：已在XAMPP中启动，使用默认端口80
- **MySQL服务**：已在XAMPP中启动，使用默认端口3306
- **访问方式**：通过 `http://localhost/` 直接访问项目
- **数据库查询**：使用 `f:\XAMPP\htdocs\mysql_test.py` 脚本查询数据库

### 1.2 禁止操作
- **严禁启动额外端口服务**（如localhost:8080、localhost:3000等）
- **严禁重启或修改XAMPP服务配置**
- **严禁使用非XAMPP的Web服务器**

## 二、问题调试流程

### 2.1 问题分析阶段
1. **快速定位**：直接查看相关代码文件，理解问题本质
2. **日志检查**：查看现有日志文件或添加临时日志输出
3. **数据库验证**：使用 `mysql_test.py` 查询相关数据状态

### 2.2 测试脚本创建规则
当需要创建测试脚本时，必须遵循以下规则：

#### 2.2.1 文件位置
- **测试脚本目录**：`F:\XAMPP\htdocs\test\`
- **命名规范**：`test_[功能名称]_[日期].php` 或 `debug_[问题描述].html`

#### 2.2.2 访问方式
- **URL格式**：`http://localhost/test/[测试文件名]`
- **示例**：`http://localhost/test/test_logout_20241215.php`

#### 2.2.3 脚本内容要求
```php
<?php
/**
 * 测试脚本：[功能描述]
 * 创建时间：[日期]
 * 用途：[具体测试目的]
 * 完成后删除：是
 */

// 引入必要的配置和工具
require_once '../config/database.php';
require_once '../api/utils.php';

// 测试逻辑
echo "<h2>测试开始</h2>";

// 具体测试代码

echo "<h2>测试完成</h2>";
?>
```

### 2.3 问题解决验证
1. **功能测试**：通过浏览器访问测试脚本验证修复效果
2. **数据验证**：使用 `mysql_test.py` 确认数据库状态正确
3. **清理工作**：删除临时测试文件和调试代码

## 三、常见问题处理模式

### 3.1 API接口问题
```bash
# 问题定位流程
1. 查看接口文件代码 → view_files
2. 创建测试脚本验证接口 → write_to_file (test目录)
3. 通过浏览器访问测试 → 用户手动测试或curl命令
4. 修复问题 → update_file
5. 再次验证 → 重新访问测试脚本
6. 清理测试文件 → delete_file
```

### 3.2 数据库相关问题
```bash
# 数据库问题处理流程
1. 使用mysql_test.py查询当前状态 → run_command
2. 分析数据结构和内容
3. 修改相关PHP代码
4. 创建数据库操作测试脚本
5. 验证修复效果
6. 清理测试文件
```

### 3.3 前端功能问题
```bash
# 前端问题处理流程
1. 查看HTML/JS代码 → view_files
2. 创建简化测试页面 → write_to_file (test目录)
3. 通过localhost访问测试页面
4. 修复原始文件中的问题
5. 验证修复效果
6. 删除测试页面
```

## 四、工具使用规范

### 4.1 数据库查询
- **唯一工具**：`f:\XAMPP\htdocs\mysql_test.py`
- **调用方式**：`run_command` 执行Python脚本
- **用途**：查看表结构、数据内容、验证操作结果

### 4.2 文件操作
- **查看文件**：`view_files`
- **修改文件**：`update_file` 或 `edit_file_fast_apply`
- **创建测试文件**：`write_to_file`（仅限test目录）
- **删除测试文件**：`delete_file`（任务完成后必须执行）

### 4.3 命令执行
- **限制范围**：仅用于执行Python脚本和简单的文件操作
- **禁止操作**：启动Web服务、修改系统配置、安装软件包

### 4.4 Windows终端命令规范
为避免PowerShell和CMD命令语法错误，必须遵循以下规范：
通常需要执行以下操作才能导航到f盘指定路径：
f:
cd f:\XAMPP\htdocs

#### 4.4.1 PowerShell命令规范
- **Python脚本执行**：
  ```powershell
  python "f:\XAMPP\htdocs\mysql_test.py"
  ```
- **文件路径处理**：使用双引号包围包含空格的路径
- **常用命令格式**：
  ```powershell
  # 查看文件内容
  Get-Content "路径\文件名"
  
  # 列出目录
  Get-ChildItem "路径"
  
  # 执行PHP脚本
  php "路径\脚本名.php"
  ```

#### 4.4.2 CMD命令备用方案
当PowerShell命令失败时，使用CMD作为备用：
- **Python脚本执行**：
  ```cmd
  python "f:\XAMPP\htdocs\mysql_test.py"
  ```
- **文件操作**：
  ```cmd
  # 查看文件
  type "路径\文件名"
  
  # 列出目录
  dir "路径"
  ```

#### 4.4.3 命令执行最佳实践
1. **路径规范**：
   - 使用绝对路径避免相对路径错误
   - 路径中包含空格时必须用双引号包围
   - 使用反斜杠（\）作为Windows路径分隔符

2. **错误处理**：
   - 首次尝试PowerShell命令
   - 失败时自动切换到CMD命令
   - 记录失败的命令格式，避免重复错误

3. **常见错误避免**：
   - 避免使用单引号（PowerShell中可能导致问题）
   - 避免混用正斜杠和反斜杠
   - 确保命令参数格式正确

4. **验证机制**：
   - 执行前检查文件路径是否存在
   - 命令执行后检查返回码
   - 失败时提供清晰的错误信息

## 五、成功标准与清理

### 5.1 任务完成标准
1. **功能正常**：问题得到解决，功能按预期工作
2. **数据正确**：数据库状态符合预期
3. **代码整洁**：移除所有调试代码和临时注释
4. **文件清理**：删除所有测试文件

### 5.2 清理检查清单
- [ ] 删除test目录下的所有测试文件
- [ ] 移除代码中的console.log和临时注释
- [ ] 确认没有遗留的调试输出
- [ ] 验证核心功能正常工作

## 六、应急处理

### 6.1 当遇到复杂问题时
1. **分解问题**：将复杂问题拆分为多个简单步骤
2. **逐步验证**：每个步骤都创建对应的测试脚本验证
3. **保持环境**：始终在XAMPP环境下操作，不引入额外复杂性
4. **及时清理**：每完成一个步骤就清理对应的测试文件

### 6.2 错误恢复
如果意外启动了额外服务或修改了配置：
1. 立即停止额外服务
2. 恢复XAMPP原始配置
3. 重新在localhost环境下测试
4. 向用户说明情况并道歉

---

**核心原则**：在XAMPP环境下，通过localhost直接访问，使用测试脚本验证问题和解决方案，完成后及时清理，保持环境整洁。