# Wallpaper Haven 首页功能分析文档

## 一、页面整体布局结构

### 1.1 导航栏 (Header)
- **位置**: 页面顶部，sticky定位
- **背景**: 半透明白色背景 + 毛玻璃效果 (backdrop-filter: blur)
- **内容组成**:
  - Logo区域: "Wallpaper Haven" 品牌标识
  - 搜索框: 桌面端和移动端分别适配
  - 二维码按钮: 显示站点二维码
  - 上传按钮: 跳转到上传页面
  - 用户菜单: 登录/注册/用户信息下拉菜单
  - 移动端菜单按钮

### 1.2 主内容区 (Main)
#### 1.2.1 分类导航区域
- **布局**: 水平滚动容器 (`overflow-x-auto`)
- **分类标签**: 动态生成的分类按钮，支持"全部"和自定义分类
- **交互**: 点击切换分类，URL参数同步 (`category=xxx`)
- **样式**: 圆角按钮设计，选中状态高亮显示
- **响应式**: 移动端优化滚动体验

#### 1.2.2 视图控制区域
- **页面标题**: "精选壁纸" 动态标题显示
- **视图切换按钮**: 
  - 网格视图按钮 (默认): `fa-th` 图标
  - 列表视图按钮: `fa-list` 图标
  - 状态同步到URL参数 (`view=grid|list`)
- **布局**: Flexbox布局，标题左对齐，按钮右对齐

#### 1.2.3 壁纸展示核心区域
- **网格视图 (默认)**:
  - 瀑布流布局 (CSS Columns + JavaScript增强)
  - 响应式列数: 移动端1列，平板2列，桌面3列，大屏4列
  - 卡片间距: 1rem，圆角设计
- **列表视图**:
  - CSS Grid三列布局
  - 固定高度卡片，统一对齐
  - 更紧凑的信息展示
- **壁纸卡片结构**:
  ```html
  <div class="masonry-item">
    <div class="wallpaper-card">
      <img class="wallpaper-thumb" loading="lazy" />
      <div class="wallpaper-actions">
        <!-- 流放/召回操作图标 -->
      </div>
    </div>
  </div>
  ```

#### 1.2.4 分页控制区域
- **加载更多按钮**: 手动触发分页加载
- **状态管理**: 
  - 默认状态: "加载更多壁纸"
  - 加载中: "加载中..." + 禁用状态
  - 全部加载: "已加载全部内容"
- **性能优化**: 防重复点击，加载状态视觉反馈

### 1.3 页脚 (Footer)
- **品牌信息**: Logo和名称
- **导航链接**: 关于我们、使用条款等
- **社交媒体**: Facebook、Twitter、Instagram、GitHub链接
- **版权信息**: 版权声明

## 二、核心交互功能

### 2.1 搜索功能
- **实现方式**: 防抖搜索 (300ms延迟)
- **搜索范围**: 壁纸名称、标签、分类
- **URL同步**: 搜索关键词同步到URL参数
- **响应式**: 桌面端和移动端分别有独立搜索框

### 2.2 视图模式切换
#### 2.2.1 网格视图 (Grid View)
- **布局**: 瀑布流布局 (masonry-grid)
- **响应式列数**:
  - 移动端: 1列
  - 平板: 2列
  - 桌面: 3列
  - 大屏: 4列
- **卡片间距**: 1rem
- **默认模式**: 是

#### 2.2.2 列表视图 (List View)
- **布局**: CSS Grid布局 (list-view-grid)
- **列数**: 三列布局，自适应
- **URL参数**: view=list
- **卡片样式**: 与网格视图相同

### 2.3 壁纸卡片交互
#### 2.3.1 卡片基本结构
```html
<div class="masonry-item">
  <div class="wallpaper-card">
    <img class="wallpaper-thumb" />
    <div class="wallpaper-actions">
      <!-- 操作图标 -->
    </div>
  </div>
</div>
```

#### 2.3.2 点击行为
- **缩略图点击**:
  - 桌面端: 打开详情模态框
  - 移动端: 跳转到 detail-mobile.html
- **操作图标点击**: 执行对应的流放/召回操作

### 2.4 流放与召回功能
#### 2.4.1 流放 (Ban)
- **触发**: 点击流放图标
- **确认**: 弹出确认对话框
- **效果**: 
  - 设置 wallpaper.isBanned = true
  - 从DOM中移除卡片
  - 保存状态到localStorage
- **数据属性**: data-action="ban"

#### 2.4.2 召回 (Recall)
- **触发**: 点击召回图标
- **确认**: 无确认提示
- **效果**:
  - 设置 wallpaper.isBanned = false
  - 从DOM中移除卡片
  - 保存状态到localStorage
- **数据属性**: data-action="recall"

### 2.5 收藏与点赞功能
#### 2.5.1 点赞功能
- **状态管理**: wallpaper.isLiked
- **持久化**: localStorage存储
- **UI反馈**: 图标状态变化
- **后端对接**: 预留initLikeButton方法

#### 2.5.2 收藏功能
- **后端对接**: 预留initFavoriteButton方法
- **状态同步**: 与用户账户关联

### 2.6 分页加载 ("加载更多")
- **实现方式**: 手动触发分页
- **状态管理**: 
  - currentPage: 当前页码
  - displayedWallpapers: 已显示的壁纸集合
- **加载状态**: 按钮文字和禁用状态变化
- **结束状态**: "已加载全部内容"

## 三、模态框系统

### 3.1 登录模态框
- **触发**: 点击登录链接
- **表单字段**: 用户名、密码
- **切换**: 可切换到注册模态框
- **关闭**: 点击关闭按钮或背景

### 3.2 注册模态框
- **触发**: 点击注册链接
- **表单字段**: 用户名、邮箱、密码、确认密码
- **切换**: 可切换到登录模态框
- **关闭**: 点击关闭按钮或背景

### 3.3 壁纸详情模态框
- **触发**: 桌面端点击壁纸缩略图
- **内容**:
  - 大图预览
  - 壁纸元数据 (大小、分辨率、格式等)
  - 分类和标签
  - AI生图提示词功能
  - 预览和下载按钮
- **操作**:
  - 预览: 跳转到yulan.html
  - 下载: 压缩后下载
  - 点赞和收藏

## 四、数据管理

### 4.1 状态管理 (WallpaperManager.state)
```javascript
state: {
  allWallpapers: [],        // 所有壁纸数据
  filteredWallpapers: [],   // 过滤后的壁纸
  displayedWallpapers: new Set(), // 已显示的壁纸
  currentPage: 0,           // 当前页码
  isLoading: false,         // 加载状态
  currentViewMode: "grid",  // 视图模式
  searchKeyword: "",        // 搜索关键词
  currentWallpaper: null    // 当前选中的壁纸
}
```

### 4.2 本地存储 (localStorage)
- **键名**: "wallpaperStates"
- **存储内容**:
  ```javascript
  {
    "wallpaper_path": {
      isBanned: boolean,
      lastModified: timestamp,
      isLiked: boolean
    }
  }
  ```

### 4.3 数据加载
- **数据源**: /static/data/list.json
- **环境适配**: GitHub Pages vs 本地开发
- **重试机制**: 最多3次重试，1秒延迟
- **错误处理**: 详细错误信息显示

## 五、响应式设计

### 5.1 断点设置
- **移动端**: < 768px
- **平板**: 768px - 1024px
- **桌面**: 1024px - 1280px
- **大屏**: > 1280px

### 5.2 移动端适配
- **导航栏**: 折叠菜单
- **搜索框**: 独立的移动端搜索框
- **壁纸展示**: 单列布局
- **详情查看**: 跳转到专门的移动端页面

### 5.3 交互适配
- **点击事件**: 区分移动端和桌面端行为
- **触摸优化**: 适当的点击区域大小
- **性能优化**: 移动端减少动画效果

## 六、性能优化

### 6.1 图片优化
- **懒加载**: 预留content-visibility: auto
- **压缩下载**: 下载时自动压缩图片
- **缩略图**: 使用优化的缩略图

### 6.2 交互优化
- **防抖搜索**: 300ms延迟
- **按钮防重**: 视图切换时禁用按钮
- **状态缓存**: localStorage缓存用户操作

### 6.3 加载优化
- **分页加载**: 避免一次性加载所有数据
- **错误重试**: 网络请求失败自动重试
- **状态反馈**: 加载状态的视觉反馈

## 七、扩展功能

### 7.1 AI提示词功能
- **查看模式**: 显示AI生图提示词
- **编辑模式**: 管理员可编辑提示词
- **锁定机制**: 提示词锁定/解锁状态
- **权限控制**: 基于用户角色的编辑权限

### 7.2 调试功能
- **日志系统**: sendDebugLog函数记录用户操作
- **状态追踪**: 详细的用户行为追踪
- **错误监控**: 异常情况的详细记录

## 八、技术栈

### 8.1 前端技术
- **CSS框架**: Tailwind CSS
- **图标**: Font Awesome + 自定义SVG
- **字体**: Inter字体
- **布局**: CSS Grid + Flexbox + CSS Columns (瀑布流)

### 8.2 JavaScript架构
- **模块化**: WallpaperManager对象封装
- **事件处理**: 委托事件监听
- **状态管理**: 集中式状态管理
- **工具函数**: Utils工具类 (防抖、图片压缩等)

### 8.3 数据交互
- **API调用**: Fetch API
- **数据格式**: JSON
- **错误处理**: Promise-based错误处理
- **状态持久化**: localStorage

---

*文档生成时间: 2025年1月*
*项目: Wallpaper Haven*
*版本: 1.0*